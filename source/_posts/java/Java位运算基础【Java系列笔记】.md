---
title: Java位运算基础【Java系列笔记】
tags:
  - Java
categories:
  - Technology
  - Java
date: 2017-04-18 21:06:00
---

Java 位运算基础
<!-- more -->
[数据结构与算法之位运算](http://www.jikexueyuan.com/course/2677.html "数据结构与算法之位运算")
***

# 数据结构与算法之位运算
常用的位运算：
1. 与 `a&b`
2. 或 `a|b`
3. 取反 `~a` 
4. 异或 `a^b` 
5. 左移 `a<<b`
6. 右移 `a>>b`
7. 无符号右移 `a>>>b`

<br>
***
<br>

# 基本技巧

## 与操作

1. 指定位清零：
``` java
void clr(int a, int i) {
    // 二进制最低位是第0位
    a &= ~(1 << i);
}

// 比如 (1 << 2) 得到一个 100
// ~(1 << 2) 得到 011
// 7 & (~(1 << 2)) =  111 & 011 = 11 = 3
```
2. 获取指定位
``` java
int get(int a, int i) {
    return a & (1 << i);
}

// 比如 (1 << 2) 得到一个 100 (只有第i位为1的整数)
// 7 & (1 << 2) =  111 & 100 = 1 
```
3. 保留某些位不变
``` java
    // 例如
    a &= 0xFF; 
    // 作用：保留最低位字节 (FF)，清空高三位字节(一共32bit嘛) 
```
4. 判断一个数是否是 2 的幂
``` java
boolean isPow2(int a) {
    return (a&(a-1) == 0) && a!=0;
}

// 例如判断8 （1000）
//  8-1 = 7 (0111)
// 1000 & 0111 = 0
```
4. 奇偶性判断
``` java
// 判断末位1还是0
// 判断奇数
boolean isOdd(int a) {
    return a & 1 == 1;
}
```

## 或操作

1. 设置指定位，置为1 （相对于与操作的清零操作）    
``` java
void clr(int a, int i) {
    a |= 1 << i;
}

// 比如 (1 << 2) 得到一个 100
// 3 | (1 << 2) =  11 | 100  = 111 = 7
```

## 取反操作
1. 相反数
``` java
// 源码和补码相互转换
int oppsite(int a) {
    return ~a + 1;
}
```

## 异或操作
1. 交换两个数
``` java
void swap(int a, int b) {
    a = a ^ b;
    b = a ^ b;
    a = a ^ b;
}
// a = 111; b = 010;
// a = a ^ b = 101;
// b = a ^ b = 101 ^ 010 = 111;
// a = a ^ b = 101 ^ 111 = 010;
// 原理呢
// b = (a ^ b) ^ b = a (相当于 b 异或两次就是0)
// a = (a ^ b) ^ a 
// (最后一个式子里的a其实就是对应一开始的(a^b)) 
// (最后一个式子里的b其实就是对应一开始的(a)) 

// 本质上意义不大，通常还是用指定变量的方法
// 因为这个只用于整数
```
2. 指定位取反
``` java
void reverse(int a, int i) {
    a ^= (1 << i);
}
```

## 移位操作
1. 2的幂次
``` java
// a 扩大四倍
a << 2
// 例如 a = 2;(10)
// a << 2 = 1000 = 8
```
2. 循环移位
``` java
// 正常的移位会丢失信息
// 所以把本来要移走的位，移到地位重新组合一下
void rol(int a, int k) {
    a = (a<<k) | (a >> 32-k) ;
}
```

<br>
***
<br>

# 简单应用
1. 求平均值
``` java
int average = (a&y) + ((x^y)>>1); 
// (a&y) 为本位
// ((x^y)>>1) 为进位
```
2. ABS函数
``` java
int abs(int a) {
    // y 为符号位
    int y = x >> 31;
    return (x+y) ^ y;

    // 当x为正数，y = 0
    // 当x为负数，右移带符号 y 就是32位全为1，也就是-1了
    // 首先有公式 -x = ~x+1 = ~(x-1)
    // 这个时候 (x+y)^y = (x-1) ^ 0xFFFFFFFF = ~(x-1) = -x
    // (和全是1的数字异或就是取反呗)
}
```
3. Max 函数
``` java
int max(int x, int y) {
    return x^((x^y) & ((x-y)>>31);)

    // (x-y)>>31 获得符号位，如果 x > y就是0，反之则是-1
    // 符号位为 0 的时候，原式 = x(x^y & 0) = x
    // 符号位为 -1 的时候，原式 = x(x^y & 0xFFFFFFFF) = x^x^y=y; 
}
```
3. 常整数乘法
``` java
// flag
```



