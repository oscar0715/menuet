---
title: Zookeeper Introduction
tags:
  - Zookeeper
categories:
  - Technology
  - Architeture
date: 2017-04-13 10:19:00
---
Zookeeper Introduction

<!-- more -->

***

# Zookeeper 是什么
Zookeeper：
1. Zookeeper 是源代码开放的
2. 分布式协调服务，解决数据一致性的问题：
    - 顺序一致性
        一个客户端发起一个请求，会严格按照发起的顺序，应用到zookeeper中。
    - 原子性
        所有事务处理结果中在整个集群上的应用结果是一致的。
    - 单一视图
        无论客户端连接到集群中的哪一个服务器，看到的服务端数据都是一样的。
    - 可靠性
        一旦服务端成功应用了一个事务，并对客户端完成了响应，那么这个事务对服务端状态所产生的变更，会一直保留下来。
    - 实时性
        zookeeper 在保证在一段时间内，客户端一定能从服务端读到最新的状态。
3. 高性能
4. 可以通过调用 Zookeeper 提供的接口来解决分布式应用中的实际问题。

# Zookeeper 的应用场景
应用场景：
1. 数据订阅/发布：
    - 推模式：服务端主动向客户端推送
    - 拉模式：客户端主动去服务端获取（通常采用定时轮询的方式）
    - Zookeeper 采用两种方式相结合：
        客户端通过一定方式告诉服务器，对那些节点的数据感兴趣。服务器在这些节点的数据发生变化的时候，就通知客户端。客户端在接到通知后，主动去服务端获取数据。
2. 负载均衡
3. 命名服务：
    数据库表格的ID有两种：
    - 自动增长的ID：易于理解，适合单库单表
    - UUID：适合在分布式场景下使用，但是因为没有规律而难于理解
    - 因此可以利用Zookeeper来生成顺序增长的ID，这样可以在集群下使用易于理解的ID
4. 分布式协调/通知:
    - 心跳检测：所有机器在 Zookeeper 上注册一个临时节点，判断一个机器是否可用，只要判断，这个临时节点在 Zookeeper 中是否存在即可。这样就不需要直接去连接机器，降低复杂度。
    
# 基本概念
1. 集群角色
    - Leader
    - Follower
    - Observer
2. 会话
    - 会话是客户端和 Zookeeper 服务器建立连接， Zookeeper 中的会话叫做 Session 。
    - Session 通过客户端和服务器建立一个 TCP 的长连接来维持一个 Session
    - 通过 Session ， 客户端能够通过心跳检测与服务器保持有效绘画，也能向服务器发出请求并且获得响应。
3.  数据节点
    - 集群中的一台机器。
    - 也可以指，数据模型中的数据单元 Znode ，分为持久节点和临时节点
        zk 的数据模型是一棵树，树的节点就是 Znode ，Znode 中可以保持信息。
4. 版本
    - 悲观锁 / 乐观锁
    - 乐观锁：修改数据之前，先读出数据，得到数据的`版本号`，把版本号写入修改语句中。
    - Zookeeper版本类型：version / cversion / aversion
5. 事件监听器（Watcher）
    - ZK 允许用户在指定节点上注册一些 watcher。
    - 数据节点发生变化的时候，watcher 就会把变化的通知发给对这些数据节点感兴趣的客户端。
    - （这里是不是和订阅就相关起来了）
6. ACL 权限控制
    - ACL 就是 Access Control Lists 的缩写，有以下权限：
    - CREATE ：创建子节点的权限
    - READ ：获取节点和子节点数据的权限
    - WRITE ：更新节点数据的权限
    - DELETE ：删除节点的权限
    - ADMIN ：设置节点 ACL 的权限










